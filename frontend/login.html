<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login | ZimGrow</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#e9e7ff;
  --card:#ffffff;
  --primary:#6a5cff;
  --pink:#f25fa6;
  --text:#2b2b2b;
  --error:#ef4444;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:"Segoe UI",Inter,sans-serif}

body{
  background:var(--bg);
  min-height:100vh;
}

/* BACK */
.back-btn{
  position:fixed;
  top:20px;
  left:20px;
  padding:10px 16px;
  background:linear-gradient(90deg,var(--primary),var(--pink));
  color:#fff;
  border-radius:24px;
  font-size:14px;
  cursor:pointer;
}

/* CARD */
.wrapper{
  max-width:420px;
  margin:120px auto;
  background:var(--card);
  padding:40px;
  border-radius:28px;
  box-shadow:0 40px 80px rgba(0,0,0,.1);
  animation:fadeUp .8s ease;
}

h2{margin-bottom:6px}
p{font-size:14px;color:#666;margin-bottom:20px}

.field{
  margin-bottom:14px;
  position:relative;
}

input{
  width:100%;
  padding:14px 44px 14px 14px;
  border-radius:14px;
  border:1px solid #ddd;
  font-size:14px;
}

input.error{
  border-color:var(--error);
}

.eye{
  position:absolute;
  right:14px;
  top:38%;
  cursor:pointer;
  opacity:.6;
}

.error-text{
  font-size:12px;
  color:var(--error);
  margin-top:4px;
  display:none;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:30px;
  background:linear-gradient(90deg,var(--primary),var(--pink));
  color:#fff;
  font-size:15px;
  cursor:pointer;
  margin-top:6px;
}

.note{
  margin-top:14px;
  font-size:13px;
  text-align:center;
  color:#888;
}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(40px)}
  to{opacity:1}
}
</style>
</head>

<body>

<div class="back-btn" onclick="location.href='index.html'">‚Üê Back</div>

<div class="wrapper">
  <h2 id="welcome">Welcome Back</h2>
  <p>Login to access your dashboard</p>

  <div class="field">
    <input id="email" type="email" placeholder="Email Address">
    <div class="error-text" id="emailErr"></div>
  </div>

  <div class="field">
    <input id="password" type="password" placeholder="Password">
    <span class="eye" onclick="togglePass()">üëÅÔ∏è</span>
    <div class="error-text" id="passErr"></div>
  </div>

  <button onclick="login()">Login</button>

  <div class="note">
    Don‚Äôt have an account? <a href="register.html">Register</a>
  </div>
</div>

<script>
  const API_URL = "https://zimgrowth-backend.onrender.com";
  
  function togglePass(){
    const p=document.getElementById("password");
    p.type = p.type==="password" ? "text" : "password";
  }
  
  function clearErrors(){
    document.querySelectorAll(".error-text").forEach(e=>e.style.display="none");
    document.querySelectorAll("input").forEach(i=>i.classList.remove("error"));
  }
  
  function showError(id,msg){
    const e=document.getElementById(id);
    e.innerText=msg;
    e.style.display="block";
    e.previousElementSibling.classList.add("error");
  }
  
  async function login(){
    clearErrors();
  
    const email = document.getElementById("email").value.trim().toLowerCase();
    const password = document.getElementById("password").value;
  
    let ok = true;
  
    if(!email){
      showError("emailErr","Email is required");
      ok = false;
    }
  
    if(!password){
      showError("passErr","Password is required");
      ok = false;
    }
  
    if(!ok) return;
  
    try{
      const res = await fetch(`${API_URL}/auth/login`,{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({ email, password })
      });
  
      const data = await res.json();
  
      if(!res.ok){
        showError("passErr", data.message || "Login failed");
        return;
      }
  
      /* ‚úÖ SAVE SESSION */
      localStorage.setItem("token", data.token);
      localStorage.setItem("currentUser", JSON.stringify(data.user));
  
      document.getElementById("welcome").innerText =
        "Welcome, " + data.user.name + " üëã";
  
      setTimeout(()=>{
        location.href="dashboard.html";
      },900);
  
    }catch(err){
      showError("passErr","Server not reachable");
    }
  }
  </script>
  

</body>
</html>
